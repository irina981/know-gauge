spring.config.import=classpath:resilience4j.properties

# ===============================
# Application
# ===============================
spring.application.name=knowgauge-service

# ===============================
# Multipart limits (uploads)
# ===============================
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB

# ===============================
# Actuator
# ===============================
management.endpoints.web.exposure.include=health,info,metrics,env,beans,loggers
management.endpoints.web.base-path=/actuator
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# ===============================
# Logging (defaults; override in profiles)
# ===============================
logging.level.org.springframework=INFO
logging.level.com.knowgauge=INFO
logging.level.org.flywaydb=INFO

# ===============================
# JPA / Hibernate (primary DB)
# ===============================
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# ===============================
# Flyway (primary DB)
# ===============================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration

# ===============================
# KnowGauge (custom properties)
# ===============================

# --- PGVector JPA (vector DB entity manager) ---
kg.pgvector.jpa.hibernate.ddl-auto=validate
kg.pgvector.jpa.show-sql=false
kg.pgvector.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
kg.pgvector.jpa.properties.hibernate.format_sql=true

# --- PGVector Flyway (vector DB schema) ---
kg.pgvector.flyway.enabled=true
kg.pgvector.flyway.baseline-on-migrate=true
kg.pgvector.flyway.locations=classpath:db/pgvector-migration

# --- Storage (shared) ---
# NOTE: endpoint/credentials are profile-specific (dev/docker) and/or provided via environment variables.
kg.storage.type=minio
kg.storage.bucket=knowgauge-content
kg.storage.storage-key-template={tenantId}/docs/by-id/{shard3}/{documentId}/v{version}/source/content

# --- Storage timeouts (seconds) ---
kg.storage.connectTimeout=3
kg.storage.readTimeout=20
kg.storage.writeTimeout=20
kg.storage.callTimeout=25

# --- Chunking ---
kg.chunking.maxSegmentSizeInChars=700
kg.chunking.maxOverlapSizeInChars=120

# --- Embeddings / LLM provider ---
# NOTE: provide OPENAI_API_KEY via env var in dev/docker.
kg.embedding.dimension=1536
kg.embedding.provider=openai
kg.embedding.openai.api-key=${OPENAI_API_KEY}
kg.embedding.openai.model=text-embedding-3-small
kg.embedding.openai.base-url=https://api.openai.com/v1
kg.embedding.openai.timeout=30
