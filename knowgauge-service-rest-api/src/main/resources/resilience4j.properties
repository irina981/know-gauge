# ===============================
# Resilience4j (MinIO client)
#
# NOTE: MinIO retries are tricky with InputStreams; keep attempts low and retry only safe operations.
# ===============================
resilience4j.retry.instances.minio.max-attempts=1
resilience4j.retry.instances.minio.wait-duration=200ms
resilience4j.retry.instances.minio.enable-randomized-wait=true
resilience4j.retry.instances.minio.randomized-wait-factor=0.5

resilience4j.retry.instances.minio.retry-exceptions=\
com.knowgauge.core.exception.StorageUnavailableException

resilience4j.retry.instances.minio.ignore-exceptions=\
com.knowgauge.core.exception.StorageBadRequestException,\
com.knowgauge.core.exception.StorageAuthException,\
com.knowgauge.core.exception.StorageNotFoundException,\
com.knowgauge.core.exception.StorageUnexpectedException

resilience4j.bulkhead.instances.minio.max-concurrent-calls=20
resilience4j.bulkhead.instances.minio.max-wait-duration=0ms

# ===============================
# Resilience4j (OpenAiEmbeddingModel)
# ===============================
resilience4j.retry.instances.openaiEmbedding.max-attempts=3
resilience4j.retry.instances.openaiEmbedding.wait-duration=300ms
# Retry only transient failures
resilience4j.retry.instances.openaiEmbedding.retry-exceptions=\
com.knowgauge.core.exception.EmbeddingUnavailableException,\
com.knowgauge.core.exception.EmbeddingRateLimitedException
# Never retry bad input / auth / permanent errors
resilience4j.retry.instances.openaiEmbedding.ignore-exceptions=\
com.knowgauge.core.exception.EmbeddingBadRequestException,\
com.knowgauge.core.exception.EmbeddingAuthException,\
com.knowgauge.core.exception.EmbeddingUnexpectedException,\
java.lang.IllegalArgumentException
resilience4j.retry.instances.openaiEmbeddingBatch.max-attempts=2
resilience4j.retry.instances.openaiEmbeddingBatch.wait-duration=500ms
resilience4j.retry.instances.openaiEmbeddingBatch.retry-exceptions=\
com.knowgauge.core.exception.EmbeddingUnavailableException,\
com.knowgauge.core.exception.EmbeddingRateLimitedException
resilience4j.retry.instances.openaiEmbeddingBatch.ignore-exceptions=\
com.knowgauge.core.exception.EmbeddingBadRequestException,\
com.knowgauge.core.exception.EmbeddingAuthException,\
com.knowgauge.core.exception.EmbeddingUnexpectedException,\
java.lang.IllegalArgumentException

resilience4j.bulkhead.instances.openaiEmbedding.max-concurrent-calls=8
resilience4j.bulkhead.instances.openaiEmbedding.max-wait-duration=0
resilience4j.bulkhead.instances.openaiEmbeddingBatch.max-concurrent-calls=2
resilience4j.bulkhead.instances.openaiEmbeddingBatch.max-wait-duration=0

resilience4j.circuitbreaker.instances.openaiEmbedding.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.openaiEmbedding.sliding-window-size=50
resilience4j.circuitbreaker.instances.openaiEmbedding.minimum-number-of-calls=20
resilience4j.circuitbreaker.instances.openaiEmbedding.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.openaiEmbedding.wait-duration-in-open-state=20s
resilience4j.circuitbreaker.instances.openaiEmbedding.permitted-number-of-calls-in-half-open-state=5
# optional: treat timeouts as failures (usually yes)
resilience4j.circuitbreaker.instances.openaiEmbedding.record-exceptions=\
com.knowgauge.core.exception.EmbeddingUnavailableException,\
com.knowgauge.core.exception.EmbeddingRateLimitedException